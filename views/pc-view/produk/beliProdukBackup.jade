extends ../layoutBelanja
append content
    .row
        .col-sm-1
        .col-sm-7
            p <a href='/produk/daftarbykategori/#{toko.Produk[0].Kategori_Produk.id}'>#{toko.Produk[0].Kategori_Produk.kategori} </a>
             | > <a href='/produk/detail/#{toko.Produk[0].id}'> #{toko.Produk[0].nama}</a>
             | > <a href='#'> beli produk </a>
            //TODO: fungsinya di cart.tambahCart lalu ke view keranjangBelanja.jade
            form(method='post', action='/keranjang/tambah')
                table
                    tr
                        td <b style='font-size : 8pt'> Nama Produk </b><br> #{toko.Produk[0].nama}
                            input(type="hidden" name="produkId" value="#{toko.Produk[0].id}")
                            input(type="hidden" name="tokoId" value="#{toko.id}")
                        td &nbsp;
                        td Keterangan (Opsional)
                            textarea.form-control(style='margin: 0px; width: 208px; height: 75px;')
                    tr
                        td(style='padding: 0 10px 0px 0px') Jumlah Barang
                            input#jumlah.form-control(type='number' onkeyup="hitung()" name='jumlah' required=true value='1')
                        td(width=150) Harga Barang <br> Rp <span id='harga'></span>
                        td(width=150) Total Harga Barang <br> Rp <span id='total'></span>
                            input#totalHarga(type='hidden' name='totalHarga')

                            script(type='text/javascript').
                                function numberFormat(_number, _sep) {
                                    _number = typeof _number != "undefined" && _number > 0 ? _number : "";
                                    _number = _number.replace(new RegExp("^(\\d{" + (_number.length % 3 ? _number.length % 3 : 0) + "})(\\d{3})", "g"), "$1 $2").replace(/(\d{3})+?/gi, "$1 ").trim();
                                    if (typeof _sep != "undefined" && _sep != " ") {
                                        _number = _number.replace(/\s/g, _sep);
                                    }
                                    return _number;
                                }

                                //ketika input#jumlah onchange maka dijalankan fungsi hitung
                                var totalHarga = document.getElementById('totalHarga');
                                totalHarga.value = #{toko.Produk[0].harga};
                                function hitung() {
                                    var total = document.getElementById('total');
                                    var jumlah = document.getElementById('jumlah');
                                    var hasil_kali = #{toko.Produk[0].harga} * jumlah.value;
                                    total.innerHTML = numberFormat(hasil_kali + "", "."); //untuk mendapatkan nilai integer yang akan di insert ke table invoice
                                    var ongkir = document.getElementById('ongkir');
                                    var hargaSubTotal = hasil_kali + parseInt(ongkir.value);
                                    //nilai ongkir terbaru belum diambil
                                    var subTotal = document.getElementById('subTotal');
                                    var nilaiSubTotal = document.getElementById('nilaiSubTotal');
                                    subTotal.innerHTML = 'Rp ' + numberFormat(""+hargaSubTotal, ".");//untuk tampilan Rp di sub total
                                    nilaiSubTotal.value = hargaSubTotal;
                                    totalHarga.value = hasil_kali;
                                    return hasil_kali;
                                }
                                var harga = document.getElementById('harga');
                                harga.innerHTML = numberFormat("#{toko.Produk[0].harga}", ".");
                                var total = document.getElementById('total');
                                total.innerHTML = numberFormat("#{toko.Produk[0].harga}", ".");
                                //batas form pembelian
                hr
                if(penerima != '')
                    script.
                        $(document).ready(function () {
                            $("#listPenerima").change(function () {
                                $.ajax({
                                    type: 'GET',
                                    url: '/getpenerima/' + $('#listPenerima option:selected').val(),
                                    success: function (result) {
                                        var penerima = result.penerimaHTML;
                                        $('#namaPenerima').html(penerima.nama);
                                        $('#alamatPenerima').html(penerima.alamat);
                                        $('#kecamatanPenerima').html(penerima.kecamatan + ' - ');
                                        $('#kabupatenPenerima').html(penerima.Kabupaten.nama + ' - ');
                                        $('#kodePosPenerima').html(penerima.Kabupaten.kode_pos);
                                        $('#provinsiPenerima').html(penerima.Provinsi.nama);
                                        $.ajax({
                                            type: 'GET',
                                            url: '/getongkir/' + penerima.Kabupaten.id+'/'+#{toko.Produk[0].id},
                                            success : function(ongkir){
                                                //TODO: nanti digunakan untuk menghitung total biaya
                                                $('#ongkosKirim').html('<b> Rp ' + numberFormat("" + ongkir.ongkos, ".") + '</b>');
                                                $('#ongkir').val(""+ongkir.ongkos);
                                                console.log($('#ongkir').val());
                                                var subTotal = ongkir.ongkos + hitung();
                                                $('#subTotal').html('<b> Rp ' + numberFormat("" + subTotal, ".") + '</b>')
                                            }
                                        });
                                    }
                                })
                            });
                        });
                    .row
                        p: b barang belanjaan akan dikirim ke
                        select.form-control#listPenerima(required=true,style='font-size:10pt',name='penerimaId')
                            each val in penerima
                                option(value='#{val.id}') #{val.nama} - #{val.jenis_alamat}
                        br
                        br
                    .row(style='width:100%;height:90px;float:left;border : 1px solid black')
                        table
                            tr: td: input#penerimaId(type='hidden' value='#{penerima[0].id}')
                            tr: td#namaPenerima #{penerima[0].nama}
                            tr: td#alamatPenerima #{penerima[0].alamat}
                            tr: td  <span id='kecamatanPenerima'> #{penerima[0].kecamatan} -</span>
                                <span id='kabupatenPenerima'> #{penerima[0].Kabupaten.nama) -</span>
                                <span id='kodePosPenerima'>#{penerima[0].Kabupaten.kode_pos)</span>
                            tr: td#provinsiPenerima #{penerima[0].Provinsi.nama)
                else
                    script.
                        $(document).ready(function () {
                            document.getElementById('tombolBeli').disabled = true;
                        });

                .row(style='height:140px'): a.btn.btn-primary(href='/produk/tambahpenerima/#{toko.Produk[0].id}') Tambah alamat baru
                .row
                    .col-sm-5 Ongkos pengiriman &nbsp;
                        b <span id='ongkosKirim'></span>
                        input#ongkir(type='hidden',value='#{ongkosKirim}')
                    .col-sm-3 Subtotal &nbsp;
                        b <span id='subTotal'></span>
                        input#nilaiSubTotal(type='hidden' name='nilaiSubTotal' value='#{subTotal}')
                        <br/><br/>
                    script.
                        //TODO:tidak bisa diubah nilainya
                        var ongkosKirim = document.getElementById('ongkosKirim');
                        ongkosKirim.innerHTML = 'Rp '+numberFormat("#{ongkosKirim}", ".");
                        var subTotal = document.getElementById('subTotal');
                        subTotal.innerHTML = 'Rp '+numberFormat("#{subTotal}", ".");
                .alert.alert-info pengiriman menggunakan POS. Kecepatan pengiriman tergantung dari lokasi pengiriman dan lokasi tujuan. Untuk kota yang sama, umumnya memakan waktu 2-3 hari.
                center: input#tombolBeli.btn.btn-primary.form-control(type='submit' value='Beli Produk Ini')
        .col-sm-3(style='margin : 0 30px')
            h3 Informasi toko
            table
                tr: td(rowspan='4',width='110px')
                    a(href='/toko/profil/#{toko.id}'): img(src='/images/#{toko.logo}', width='100px')
                tr: td: a(href='/toko/profil/#{toko.id}') #{toko.nama}
                tr: td #{toko.Kabupaten.nama}
                tr: td: a.btn-primary.btn(href='/produk/favorit/#{toko.id}') Jadikan Favorit
    br
    br


